openapi: 3.0.3
info:
  title: Lakomka API
  version: 1.0.0
  description: REST API для сервиса рецептов

servers:
  - url: http://localhost:3000

paths:

  /auth/register:
    post:
      summary: Регистрация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        201:
          description: Пользователь создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Неверные данные

  /auth/login:
    post:
      summary: Авторизация
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        200:
          description: Успешный вход
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        401:
          description: Неверный email или пароль

  /users:
    get:
      summary: Получить список пользователей
      responses:
        200:
          description: Список пользователей
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

  /users/{id}:
    get:
      summary: Получить пользователя по ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Пользователь найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          description: Пользователь не найден

  /users/{id}/subscribe:
    post:
      summary: Подписаться на автора
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        201:
          description: Подписка создана
        409:
          description: Уже подписаны

    delete:
      summary: Отписаться от автора
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        204:
          description: Подписка удалена

  /recipes:
    get:
      summary: Получить список рецептов
      parameters:
        - in: query
          name: type_id
          schema:
            type: integer
        - in: query
          name: difficulty_id
          schema:
            type: integer
      responses:
        200:
          description: Список рецептов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Recipe'

    post:
      summary: Создать рецепт
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRecipeRequest'
      responses:
        201:
          description: Рецепт создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
        401:
          description: Требуется авторизация

  /recipes/{id}:
    get:
      summary: Получить рецепт по ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Рецепт найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
        404:
          description: Рецепт не найден

    put:
      summary: Полностью обновить рецепт
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRecipeRequest'
      responses:
        200:
          description: Рецепт полностью обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
        403:
          description: Нет прав доступа
        404:
          description: Рецепт не найден

    patch:
      summary: Частично обновить рецепт
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRecipeRequest'
      responses:
        200:
          description: Рецепт обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Recipe'
        403:
          description: Нет прав доступа
        404:
          description: Рецепт не найден

    delete:
      summary: Удалить рецепт
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        204:
          description: Рецепт удалён
        403:
          description: Нет прав доступа
        404:
          description: Рецепт не найден

  /recipes/{id}/comments:
    get:
      summary: Получить комментарии к рецепту
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Список комментариев
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'

    post:
      summary: Добавить комментарий
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommentRequest'
      responses:
        201:
          description: Комментарий создан

  /recipes/{id}/ingredients:
    get:
      summary: Получить ингредиенты рецепта
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Ингредиенты рецепта
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/RecipeIngredient'

    post:
      summary: Добавить ингредиент к рецепту
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddIngredientToRecipeRequest'
      responses:
        201:
          description: Ингредиент добавлен

  /recipes/{id}/steps:
    get:
      summary: Получить шаги рецепта
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Список шагов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Step'

    post:
      summary: Добавить шаг
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateStepRequest'
      responses:
        201:
          description: Шаг добавлен

  /recipes/{id}/like:
    post:
      summary: Поставить лайк
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        201:
          description: Лайк добавлен
        409:
          description: Лайк уже существует

    delete:
      summary: Убрать лайк
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        204:
          description: Лайк удалён

  /recipes/{id}/rating:
    post:
      summary: Поставить или обновить рейтинг
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRatingRequest'
      responses:
        200:
          description: Рейтинг сохранён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Rating'

  /ingredients:
    get:
      summary: Получить список ингредиентов
      responses:
        200:
          description: Список ингредиентов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ingredient'

    post:
      summary: Создать ингредиент
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateIngredientRequest'
      responses:
        201:
          description: Ингредиент создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ingredient'


components:
  schemas:

    Role:
      type: string
      enum: [ADMIN, CREATOR]

    RatingValue:
      type: string
      enum: [BAD, NORMAL, GOOD, EXCELLENT]

    User:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        email:
          type: string
        role:
          $ref: '#/components/schemas/Role'

    Recipe:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
        cook_time:
          type: string
        author_id:
          type: integer
        difficulty_id:
          type: integer
        type_id:
          type: integer
        created_at:
          type: string
          format: date-time

    Comment:
      type: object
      properties:
        id:
          type: integer
        recipe_id:
          type: integer
        author_id:
          type: integer
        description:
          type: string
        created_at:
          type: string
          format: date-time

    RegisterRequest:
      type: object
      required: [name, email, password]
      properties:
        name:
          type: string
        email:
          type: string
        password:
          type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string

    LoginResponse:
      type: object
      properties:
        access_token:
          type: string

    CreateRecipeRequest:
      type: object
      required: [name, description, img_url, cook_time, difficulty_id, type_id]
      properties:
        name:
          type: string
        description:
          type: string
        img_url:
          type: string
        cook_time:
          type: string
        difficulty_id:
          type: integer
        type_id:
          type: integer

    UpdateRecipeRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        img_url:
          type: string
        cook_time:
          type: string
        difficulty_id:
          type: integer
        type_id:
          type: integer

    CreateCommentRequest:
      type: object
      required: [text]
      properties:
        text:
          type: string

    Ingredient:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string

    RecipeIngredient:
      type: object
      properties:
        ingredient_id:
          type: integer
        amount:
          type: string
        unit:
          type: string

    Step:
      type: object
      properties:
        id:
          type: integer
        recipe_id:
          type: integer
        order:
          type: integer
        description:
          type: string
        image_url:
          type: string

    Rating:
      type: object
      properties:
        author_id:
          type: integer
        recipe_id:
          type: integer
        value:
          $ref: '#/components/schemas/RatingValue'

    CreateIngredientRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string

    AddIngredientToRecipeRequest:
      type: object
      required: [ingredient_id, amount, unit]
      properties:
        ingredient_id:
          type: integer
        amount:
          type: string
        unit:
          type: string

    CreateStepRequest:
      type: object
      required: [order, description]
      properties:
        order:
          type: integer
        description:
          type: string
        image_url:
          type: string

    CreateRatingRequest:
      type: object
      required: [value]
      properties:
        value:
          $ref: '#/components/schemas/RatingValue'

